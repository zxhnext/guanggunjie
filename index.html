<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta charset="utf-8">
    <script src="js/flexible.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="css/style1.css"> -->
    <script src="js/jquery.js"></script>  <!-- jquery,操作页面上html元素 -->
    <script src="js/velocity.min.js"></script> <!-- 动画库 -->
    <script src="js/velocity.ui.min.js"></script><!-- 动画库 -->
    <script src="js/shake.js"></script>
    <link rel="stylesheet/less" type="text/css" href="css/style.less">
    <script src="js/less.min.js" type="text/javascript"></script>
    <title>光棍节跟谁过</title>
</head>
<body>
	<div class="loading">
		<canvas class="circle" id="canvas"></canvas>
		<div class="loading-bg"></div>
		<div class="text"></div>
	</div>
	<div class="home">
		<div class="title"></div>
		<div class="subtitle"></div>
		<div class="entitle"></div>
		<div class="shake-wrap">
			<div class="finger"></div>
			<b class="screen screen0"></b>
            <b class="screen screen1"></b>
            <b class="screen screen2"></b>
            <b class="screen screen3"></b>
            <b class="screen screen4"></b>
            <b class="screen screen5"></b>
            <b class="screen screen6"></b>
		</div>
		<div class="shake-text"></div>
	</div>
	<div class="result">
		<ul>
			<li class="tr_scale" data-text="视野内最胖的人" data-img="share0">
				<div class="title"></div>
				<div class="answer answer0"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar avatar0"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
			<li class="tr_scale" data-text="下一个跟你说话的人" data-img="share1">
				<div class="title"></div>
				<div class="answer answer1"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar avatar1"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
			<li class="tr_scale" data-text="实习生妹子" data-img="share2">
				<div class="title"></div>
				<div class="answer answer2"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar avatar2"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
			<li class="tr_scale" data-text="小区保安大叔" data-img="share3">
				<div class="title"></div>
				<div class="answer answer3"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar avatar3"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
			<li class="tr_scale" data-text="老板大人" data-img="share4">
				<div class="title"></div>
				<div class="answer answer4"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar avatar4"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
			<li class="tr_scale" data-text="今天向你表白的人" data-img="share5">
				<div class="title"></div>
				<div class="answer"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
			<li class="tr_scale" data-text="送货员小哥" data-img="share6">
				<div class="title"></div>
				<div class="answer answer6"></div>
				<div class="avatar-wrap">
					<div class="avatar_default"></div>
					<div class="avatar avatar6"></div>
				</div>
				<div class="shake-tips tr_scale"></div>
				<div class="btns"></div>
			</li>
		</ul>
	</div>
	<div class="share">
        <div class="mask"></div>
        <div class="share-text"></div>
    </div>
	<script type="text/javascript">
		$(function(){
			var canvas = document.getElementById("canvas");
			var ctx = canvas.getContext("2d");
			function drawCircle(){
				ctx.beginPath(); //起始一条路径，或重置当前路径
				ctx.moveTo(0,0); //把路径移动到画布中的指定点，不创建线条
				ctx.arc(73,73,73,0,2*Math.PI,false);
				ctx.closePath(); //创建从当前点回到起始点的路径
				ctx.fillStyle = "#fff"; //属性设置或返回用于填充绘画的颜色、渐变或模式
				ctx.fill(); //填充当前的路径
			}
			function drawPan(percent){
				ctx.beginPath(); //起始一条路径，或重置当前路径
				ctx.moveTo(73,73); //可以去掉这个和上面的ctx.moveTo(0,0);看看会发生什么
				ctx.arc(73,73,73,0+1.5*Math.PI,1.5*Math.PI+(2*Math.PI)*percent/100,false); //10/100表示显示多少
				ctx.closePath(); //创建从当前点回到起始点的路径
				ctx.fillStyle = "#ffa9ad"; //属性设置或返回用于填充绘画的颜色、渐变或模式
				ctx.fill(); //填充当前的路径
			}
			drawCircle();

			var pics = ["css/entitle.png","css/hand.png","css/hand_finger.png","css/home_avatar0.png","css/home_avatar1.png","css/home_avatar2.png","css/home_avatar3.png","css/home_avatar4.png","css/home_avatar5.png","css/home_avatar6.png","css/home_shake_text.png","css/loading.png","css/result_answer.png","css/result_answer0.png","css/result_answer1.png","css/result_answer2.png","css/result_answer3.png","css/result_answer4.png","css/result_answer6.png","css/result_avatar.png","css/result_avatar_bg.png","css/result_avatar_bg_1.png","css/result_avatar_bg_2.png","css/result_avatar0.png","css/result_avatar1.png","css/result_avatar2.png","css/result_avatar3.png","css/result_avatar4.png","css/result_avatar6.png","css/result_btn.png","css/result_text.png","css/result_text0.png","css/result_text1.png","css/result_text2.png","css/result_text3.png","css/result_text4.png","css/result_text6.png","css/result_title.png","css/shake_tips.png","css/share.jpg","css/share.png","css/share0.jpg","css/share1.jpg","css/share2.jpg","css/share3.jpg","css/share4.jpg","css/share5.jpg","css/share6.jpg","css/subtitle.png","css/title.png","css/yue.png"];
			var count = 0;
			for (var i = 0; i < pics.length; i++) {
				var img = new Image();
				img.src = pics[i];
				img.onload = function(){
					count++;
					var percent = Math.floor(count/pics.length*100);
					drawPan(percent);
					$('.text').html(percent+'%');
					if ( i==count ) {//因为onload是异步事件,执行比下面的慢,所以要定义count
						$('.loading').hide();
						$('.home').show(function(){
							$('.home .title').velocity('callout.bounce',{complete:function(){
								$('.home .subtitle').velocity('callout.flash',{complete:function(){
									$('.home .entitle').velocity('transition.perspectiveDownIn');
								}});
							}});
						});
					}
				}
			}

			 //摇一摇
        	var shake = new Shake();
        	shake.start();
       		var shake_count = 7;
        	window.addEventListener('shake',function(){
        		if(shake_count ==0){
                	shake_count = 7;
                	$('.result ul li').removeClass('noshow');
            	}
            	$('.home').hide();
            	$('.result').show();
            	var radom = parseInt(Math.random()*shake_count);
            	var $t = $('.result ul li:not(.noshow)').eq(radom);
            	$t.show().addClass('noshow').siblings().hide();
            	shake_count--;
            	$('.avatar-wrap',$t).velocity({rotateY:'3600deg'},{duration:3000,complete:function(){
            		$('.avatar',$t).velocity('transition.expandIn');
                	$('.answer',$t).velocity('transition.bounceIn');
            	}})
        	});
       		$('.result').on('click','.btns',function(){
           		$('.share').show();
       		});
       		$('body').on('click','.share',function(){
           		$('.share').hide();
       		});
    	});
	</script>
</body>
</html>